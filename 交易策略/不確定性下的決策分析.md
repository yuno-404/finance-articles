---
title: 不確定性下的決策分析

---

## 不確定性下的決策分析
之前 KELLY CRITERION 的時候，沒有特別去定義賭局
因此打算針對賭局中的效用去補充，筆記內容會參考 個體經濟學-楊雲明的書籍。

----
### 公平賭局
一個賭局被稱為「公平賭局」，必須滿足以下條件：
$$參與者的「預期淨收益」(Expected Net Gain) 為零$$
換句話說，如果你玩這個遊戲無限多次，長期下來你不賺也不賠。
用數學公式表示：
設 $X$ 為隨機變數，代表某次賭局的淨收益（贏的錢減去輸的錢或入場費）。$$E[X] = 0$$
或者另一種等價的說法：
$$參加賭局的成本（入場費）等於賭局的期望獎金。$$$$C = E[R]$$
其中 $C$ 是參加費用，$E[R]$ 是期望回報（Expected Return）。

#### 擲硬幣
假設我們玩一個擲硬幣的遊戲，硬幣是公正的（正面、反面機率各為 $0.5$）。
#### 情況 A：公平賭局
$$E[\text{Net}] = 0$$$$E[R] = C$$

(期望拿回來的錢 = 付出的成本)

#### 情況 B：不利賭局
長期下來，玩家必定虧損。這是所有賭場遊戲（Roulette, Slot Machines）的設計基礎
$$E[\text{Net}] < 0$$或者等價於：$$E[R] < C$$
(期望拿回來的錢 < 付出的成本)
#### 賭場優勢 (House Edge)：
賭場通常會用百分比來表示這個「不公平」的程度：$$\text{House Edge} = \frac{|E[\text{Net}]|}{C} \times 100\%$$

#### 情況 C：有利賭局
 長期下來，玩家能夠獲利。這通常發生在玩家擁有特殊優勢（如算牌、內線消息、套利機會）時。$$E[\text{Net}] > 0$$或者等價於：$$E[R] > C$$(期望拿回來的錢 > 付出的成本)
 
只有在這種情況下（$E > 0$），職業賭徒才會下注。著名的 凱利公式 (Kelly Criterion) 就是用來計算在這種「有利賭局」中，應該下注多少比例的資金，以最大化財富增長速度

----
### St. Petersburg Paradox
這是一個在機率論和決策論中非常著名的悖論，由尼古拉·伯努利 (Nicolaus Bernoulli) 在 1713 年提出，後來由丹尼爾·伯努利 (Daniel Bernoulli) 在 1738 年發表了解決方案。這個悖論挑戰了當時「理性決策者總是極大化期望值 (Expected Value)」的觀點，並奠定了期望效用理論 (Expected Utility Theory) 的基礎。

#### 遊戲規則
假設有一個擲硬幣的賭局，規則如下：
* 你擲一枚公正的硬幣。
* 如果第一次就出現「反面」，遊戲結束，你得到 2 元。
* 如果第一次是「正面」，你再擲一次。若第二次是「反面」，遊戲結束，你得到 4 元 ($2^2$
* 以此類推，直到出現第一次反面為止。如果在第 $n$ 次才出現反面，你得到的獎金是 $2^n$ 元

**問題是：你願意付多少錢來玩這個遊戲？**
#### 數學上的「期望值」 (The Expected Value)
* 如果我們計算這個遊戲的數學期望值（平均每次玩能拿到的錢），會發現一個驚人的結果。
* 第 1 次出反面的機率是 $\frac{1}{2}$，獎金是 $2$ 元。 $\rightarrow$ 貢獻值： $\frac{1}{2} \times 2 = 1$
* 第 2 次出反面的機率是 $\frac{1}{4}$，獎金是 $4$ 元。 $\rightarrow$ 貢獻值： $\frac{1}{4} \times 4 = 1$
* 第 3 次出反面的機率是 $\frac{1}{8}$，獎金是 $8$ 元。 $\rightarrow$ 貢獻值： $\frac{1}{8} \times 8 = 1$...
* 第 $n$ 次出反面的機率是 $\frac{1}{2^n}$，獎金是 $2^n$ 元。 $\rightarrow$ 貢獻值： $\frac{1}{2^n} \times 2^n = 1$

總期望值 $E$ 為無窮級數之和：$$E = \sum_{n=1}^{\infty} \left( \frac{1}{2^n} \times 2^n \right) = 1 + 1 + 1 + \dots = \infty$$

既然期望值是無限大，理性的玩家應該願意付出「任意高」的金額（例如一億元、全部家產）來玩一次。但實際上，直覺告訴我們，絕大多數人連 20 元都不一定願意付。這中間的落差就是「悖論」

#### 期望效用 (Expected Utility)
人在做決策時，看的不是金額的期望值 (Expected Monetary Value)，而是效用的期望值 (Expected Utility)
#### 邊際效用遞減 (Diminishing Marginal Utility)：
錢越多，每多一塊錢帶給你的快樂（效用）就越少。對於一個普通人來說，贏得 100 萬的快樂，並不是贏得 1 塊錢快樂的 100 萬倍。
伯努利假設效用函數是對數形式，例如 $$U(x) = \ln(x)$$
在這種情況下，雖然獎金金額是指數增長 ($2^n$)，但帶給人的「效用」增長得很慢。當我們計算「期望效用」時，級數會收斂（變成一個有限的數字），這就解釋了為什麼人們只願意花少量的錢去玩這個遊戲

#### 你願意付多少錢在這場賭局上?
理性的決策者不是看「平均能贏多少錢」（那是無限大），而是看「這個賭局平均能帶給我多少快樂」
假設你的初始財富是 $0$（為了簡化計算），效用函數是 $U(x) = \ln(x)$。
賭局的期望效用 (Expected Utility, EU) 是每一種結果的效用乘上機率的總和：$$E[U] = \sum_{n=1}^{\infty} \left( \text{機率} \times \text{獎金的效用} \right)$$
$$E[U] = \sum_{n=1}^{\infty} \left( \frac{1}{2^n} \times \ln(2^n) \right)$$利用對數性質 $\ln(2^n) = n \ln(2)$，公式變成：$$E[U] = \ln(2) \sum_{n=1}^{\infty} \frac{n}{2^n}$$數學上，無窮級數 $\sum_{n=1}^{\infty} \frac{n}{2^n}$ 的總和收斂於 2（計算過程：$\frac{1}{2} + \frac{2}{4} + \frac{3}{8} + \dots = 2$）。所以，這個賭局的總期望效用是：$$E[U] = 2 \ln(2) = \ln(2^2) = \ln(4)$$

這代表玩這個遊戲帶給你的「快樂程度」，相當於直接給你 **4** 元 的快樂程度。
**理性的參加門檻（又稱確定性等值 Certainty Equivalent）是 4 元**

#### 什麼情況下會參加？
決定你是否參加的條件是：入場費 (Cost) 是否低於你心中的等值金額
更白話一點就是:
「我為了玩這個遊戲所犧牲的『快樂程度』，必須少於（或等於）這個遊戲平均能帶給我的『快樂程度』。」

當你決定參加賭局，你必須先掏出腰包裡的錢（例如 100 元）。這 100 元本來可以拿去買便當、喝咖啡，現在沒了
* 物理上：你的財富減少了 100 元
* 心理上（效用）：你的「滿足感」下降了

因為賭局的結果是不確定的（可能贏 2 元，可能贏 100 萬），我們不能只看最好的結果，要看「平均」。
* 物理上：計算期望獎金（Expected Value）
* 心理上（效用）：計算各種結果帶來的快樂，然後加權平均，這就是預期效用 (Expected Utility)。


#### 聖彼得堡遊戲（期望獎金無限大）
假設情境：
* 賭局：聖彼得堡遊戲（期望獎金無限大）
* 入場費：1 萬元
* 你的財產：你剛好只有 1 萬元

#### 1. 左邊：付錢的代價
如果你付了這 1 萬元，你的財產變成 0。
* 效用下降：從「生活無虞」變成「流落街頭」。
* 單位：這 1 萬元的效用簡直是天大的數值（因為它保命）。

#### 2. 右邊：賭局的預期快樂
雖然這遊戲可能讓你贏 1 億，但機率極低；大部分時候你只贏 2 元或 4 元。
* 預期效用：根據伯努利的計算，這個遊戲帶給你的平均快樂，只相當於穩拿 4 元 的快樂。
* 單位：非常小。

#### 3. 比較結果（不等式）$$\text{失去 1 萬元的痛苦 (巨大)} > \text{遊戲帶來的平均快樂 (微小)}$$
因為 左邊 > 右邊，所以你不玩。

#### 總結
可以在這裡做個簡單的總結
$$E[U(W - C + X)] \ge U(W)$$
* 左邊：付了錢 $C$，進入賭局面對隨機變數 $X$（獎金），最終財富的期望效用
* 右邊：不玩，保有原財富 $W$ 的效用

這解釋了為什麼即便期望值無限大，我們也不願意花大錢去賭，因為付大錢的「心痛值」成長得太快了

----
### 風險態度
附上我覺得可以幫助理解的優秀影片
{%preview https://www.youtube.com/watch?v=VAC6rb45XcA %}
有的人喜歡定存、有的人喜歡定期定額、有的人喜歡重壓加密貨幣，那要如何去計算個別的風險呢?
讓我重新的定義一次
* 初始財富：$W$
* 公平賭局 (Fair Game)：一個隨機變數 $Z$，代表賭局的淨收益。因為是公平賭局，其期望值為 0。$$E[Z] = 0$$
* 參與決策：
	* 如果不參加，效用為：$U(W)$
	* 如果參加，財富變成隨機變數 $W+Z$，其期望效用為：$E[U(W+Z)]$
* 判斷標準：
	* 若 $E[U(W+Z)] > U(W)$ $\rightarrow$ 參加
	* 若 $E[U(W+Z)] < U(W)$ $\rightarrow$ 不參加
	* 若 $E[U(W+Z)] = U(W)$ $\rightarrow$ 沒差 (無差異)

####  風險趨避者
**結論：不會參加公平賭局。**
#### 定義
* 風險趨避者的效用函數 $U(x)$ 是凹函數 (Concave Function)
* 數學特徵：二階導數小於 0 ($U'' < 0$)
* 代表邊際效用遞減：賺 100 元的快樂 < 賠 100 元的痛苦
![image](https://hackmd.io/_uploads/S1Jjw1pDbg.png)

對於任意凹函數 $f(x)$，詹森不等式指出：$$E[f(X)] < f(E[X])$$(函數的期望值 小於 期望值的函數值)

將其套用到我們的賭局：$$E[U(W+Z)] < U(E[W+Z])$$
因為期望運算的線性性質 $E[W+Z] = W + E[Z]$，且已知 $E[Z]=0$ (公平賭局)：$$E[W+Z] = W + 0 = W$$
代回不等式：$$E[U(W+Z)] < U(W)$$
因為輸錢的痛苦大於贏錢的快樂，即使平均來說不賺不賠，參加賭局會讓你的「總快樂值」下降。所以理性上拒絕參加。

所以，風險趨避者是不會參與公平和不利賭局，但是有可能會參與有利賭局。

#### 風險愛好者
![image](https://hackmd.io/_uploads/rk_5lWaw-x.png)
* 風險愛好者的效用函數 $U(x)$ 是凸函數 (Convex Function)。
* 數學特徵：二階導數大於 0 ($U'' > 0$)。
* 這代表邊際效用遞增：贏 100 元的快樂 > 輸 100 元的痛苦。他們追求波動性 (Volatility)。

風險愛好者追求的是「極端獲利的效用」。即便期望值是負的（如樂透、賭場），只要最大獎金 $Max(X)$ 帶來的效用 $U(Max(X))$ 極高，拉高了整體的 $E[U]$，使其大於 $U(W)$，他們就會參加。所以他必定參加公平和有利賭局，對於風險愛好者（凸函數 $U'' > 0$）來說，他們常常會參加「不利賭局」（$E[Net] < 0$），只要波動性（最大獎）夠大。

#### 風險中立者
圖形則是一條斜直線。
* 風險中立者的效用函數 $U(x)$ 是線性函數 (Linear Function)。
* 數學特徵：二階導數等於 0 ($U'' = 0$)，通常形式為 $U(x) = ax + b$。
* 這代表邊際效用固定：賺 100 元的快樂 = 賠 100 元的痛苦。

風險中立者只看「錢的期望值」。因此會參加有利賭局，不參加不利賭局，公平賭局則是可有可無。

----
### 風險報酬和標準差
前面我們用『效用-財富』圖來解釋心理感受，現在我們轉換到金融投資常用的『報酬-風險』平面圖來看投資選擇
![image](https://hackmd.io/_uploads/Bke90b6wWe.png)

#### 風險趨避者 (Risk Averse) —— 「高風險必須伴隨高報酬」　
這是絕大多數投資人（以及現代投資組合理論 CAPM）的預設模型。
* 討厭標準差 ($\sigma$)。風險是「成本」，報酬是「收益
* 如果要我承擔更高的風險（$\sigma \uparrow$），你必須給我更高的預期報酬（$E[r] \uparrow$）作為補償。這多出來的報酬稱為風險溢酬 (Risk Premium
* 斜率是大於 0 的：因為 $\sigma$ 增加，$E[r]$ 必須增加才能維持同樣的快樂（效用）
* 越往右邊越陡峭：隨著風險越來越高，你對每一單位新增風險的恐懼感會急遽上升，要求的補償金也會暴增

#### 風險中立者 (Risk Neutral) —— 「只看期望值，風險沒差」
這是機構投資人或擁有無限分散能力的理論模型。
* 無視標準差 ($\sigma$)。風險不是成本，也不是收益，只是雜訊。他們只在乎預期報酬 ($E[r]$) 的大小
* 只要預期報酬一樣（例如都是 10%），不管是定存（$\sigma \approx 0$）還是加密貨幣（$\sigma$ 很大），對他來說價值完全相等
* 斜率等於 0：標準差的增減不影響他們的滿足感
* 他們會選擇 $E[r]$ 最高的那個投資標的，完全不管 $\sigma$ 是多少

#### 風險愛好者 (Risk Seeking) —— 「為了刺激，願意少賺點」
這通常描述賭徒心理，或者在極端困境下（想翻本）的決策者。
* 熱愛標準差 ($\sigma$)。波動本身就是快樂的來源（刺激感
* 因為風險（波動）帶給他快樂，他甚至願意為了追求高風險而犧牲一點預期報酬
* 斜率小於 0：當風險 ($\sigma$) 增加時，因為他獲得了「刺激感的快樂」，所以他可以接受較低的金錢回報 ($E[r]$) 而維持同樣的滿足感

----
### Prospect Theory
傳統理論看的是「最終財富總量」，展望理論看的是「相對於參考點的變化（盈虧）」
* 人的快樂不是由絕對財富決定的，而是由現狀 (Status Quo) 決定的。
	* A：昨天有 500 萬，今天變成 1000 萬 $\rightarrow$ 狂喜。
	* B：昨天有 2000 萬，今天變成 1000 萬 $\rightarrow$ 痛苦。
* 決策是基於「改變量 ($x$)」，而非「最終量 ($W$)」

#### 敏感度遞減 (Diminishing Sensitivity) —— S 型曲線
* 獲利區 (Gains)：賺 100 元到 200 元的快樂，大於賺 1000 元到 1100 元的快樂。函數是凹的 (Concave)。
* 損失區 (Losses)：賠 100 元到 200 元的痛苦，大於賠 1000 元到 1100 元的痛苦。函數是凸的 (Convex)。
![image](https://hackmd.io/_uploads/rJe9lfTv-x.png)

#### 損失趨避 (Loss Aversion) —— 痛比快樂強烈
損失帶來的痛苦，大約是同等金額獲利快樂的 2.25 倍
$$v(x) = \begin{cases} 
x^\alpha & \text{if } x \ge 0 \\ 
-\lambda(-x)^\beta & \text{if } x < 0 
\end{cases}$$
* $x$：損益金額
* $\alpha, \beta$：風險態度參數（通常取 0.88），代表敏感度遞減（小於 1 代表曲線彎曲）。
* $\lambda$：損失趨避係數（實驗測得約為 2.25）。這代表損失的權重是獲利的 2.25 倍。

#### 機率加權函數 (The Weighting Function)
傳統理論假設人對機率 $p$ 的感知是線性的（1% 就是 1%）。但在展望理論中，人對機率的主觀感受 $\pi(p)$ 是扭曲的。
* 高估小機率:例如買樂透（高估中獎機率）
* 低估大機率:例如明明有 90% 勝率，卻過度擔憂那 10% 的失敗

在累積展望理論中(CPT)獲利與損失的決策權重函數 $w(p)$ 形式相同，但參數略有不同
#### 對於獲利機率 (For Gains, $x \ge 0$)：
$$w^+(p) = \frac{p^\gamma}{(p^\gamma + (1-p)^\gamma)^{1/\gamma}}$$
* $\gamma$ (Gamma)：獲利域的曲率參數
* 實驗值：Tversky & Kahneman (1992) 測得 $\gamma \approx 0.61$

#### 對於損失機率 (For Losses, $x < 0$)
$$w^-(p) = \frac{p^\delta}{(p^\delta + (1-p)^\delta)^{1/\delta}}$$
* $\delta$ (Delta)：損失域的曲率參數
* 實驗值：Tversky & Kahneman (1992) 測得 $\delta \approx 0.69$

![image](https://hackmd.io/_uploads/HkzXIMaPWx.png)
* 灰線 ($\gamma = 1.0$)：理性基準線
	* 這是一條 45 度的對角線。客觀機率是多少，主觀感受就是多少。這是傳統期望效用理論的假設
* 藍線 ($\gamma = 0.61$)：典型的人性曲線
	* 左下角：藍線在灰線上方 $\rightarrow$ 高估小機率 (買樂透)
	* 右上角：藍線在灰線下方 $\rightarrow$ 低估大機率 (確定性效應)
	* 交叉點：大約在 $0.35$ 左右，這是分界點
		* 	當 $p < 0.35$：$w(p) > p$（高估機率，出現「以小博大」行為）
		* 當 $p > 0.35$：$w(p) < p$（低估機率，出現「保守求穩」行為）
* 紅線 ($\gamma = 0.3$)：極度扭曲的曲線
	* 中間那一段幾乎是平的 (Flat)。這代表從機率 $0.2$ 到 $0.8$，你的心理感受幾乎沒變。
	* 顯示了極端的「二分法」思維：只要不是 0，就覺得很有機會；只要不是 100%，就覺得很不穩
#### 展望理論的總期望值公式
結合上述兩者，一個賭局 $X$ 的展望價值 $V(X)$ 計算如下：$$V(X) = \sum_{i=1}^{n} \pi(p_i) v(x_i)$$
* $\pi(p_i)$：扭曲後的機率權重
* $v(x_i)$：扭曲後的價值感受（考慮了損失趨避）

### 為什麼傳統的 $E[U] = \sum p U(x)$ 是錯的？
* 實驗 A (獲利)：
	* 穩拿 500 元。50% 機率拿 1000 元，50% 拿 0 元。
	* 結果：多數人選 1 (風險趨避)。
	* 推導：在獲利區間，效用函數是凹的 ($U'' < 0$)
* 實驗 B (損失)：
	* 穩賠 500 元。50% 機率賠 1000 元，50% 賠 0 元。
	* 結果：多數人選 2 (風險愛好)。
	* 推導：在損失區間，效用函數變成了凸的 ($U'' > 0$)。人們為了「避免確定的損失」，願意去賭一把大的。
	
	
### 結論
* 為什麼散戶抱不住獲利？ $\rightarrow$ 獲利時是風險趨避（凹函數），一點波動就想賣
* 為什麼散戶會凹單到破產？ $\rightarrow$ 虧損時是風險愛好（凸函數），隨著虧損擴大，邊際痛感遞減，且為了「回本」願意承擔極大風險。
* 為什麼會有「處置效應」(Disposition Effect)？ $\rightarrow$ 賣出賺錢股票（享受快樂）太快，持有賠錢股票（逃避痛苦）太久。